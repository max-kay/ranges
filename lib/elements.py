# Musical symbols taken from the default font of MuseScore 4

import drawsvg as draw

PX_PER_CM = 28.3
A4 = 21 * PX_PER_CM, 29.7 * PX_PER_CM
FONT_FAMILY = "FreeSerif"
TEXT_MARGIN_FACTOR = 0.75

NOTE_WIDTH = 2.98
ACC_MARGIN = 0.5

STAFF_STROKE_WIDTH = 0.22
BAR_LINE_WIDTH = 0.36


def translated_group(elem, x, y) -> draw.Group:
    return draw.Group(children=[elem], transform=f"translate({x} {y})")


def from_musescore(
    string: str, translate: str | tuple[float, float] = "0 0"
) -> draw.Path:
    return draw.Path(
        fill="black", d=string, transform=f"translate({translate}) scale(.08)"
    )


FULL_NOTEHEAD = from_musescore(
    "M18.7,-13.6 C4.9,-13.6 0,-6.6 0,-0.1 C0,6.4 4.9,13.4 18.7,13.4 C32.5,13.4 37.3,6.4 37.3,-0.1 C37.3,-6.6 32.5,-13.6 18.7,-13.6",
)

EMPTY_NOTEHEAD = from_musescore(
    "M18.7,-13.6 C4.9,-13.6 0,-6.6 0,-0.1 C0,6.4 4.9,13.4 18.7,13.4 C32.5,13.4 37.3,6.4 37.3,-0.1 C37.3,-6.6 32.5,-13.6 18.7,-13.6 M19.5,10.2 C16.7,10.2 14.8,9.4 13.5,6.9 C12.2,4.4 10.4,-2.1 10.3,-4.7 C10.1,-7.4 11.1,-9 13.5,-9.8 C14.7,-10.2 16.3,-10.4 17.9,-10.4 C20.6,-10.4 22.4,-9.8 23.8,-7.1 C25.2,-4.5 27.1,2 27.1,4.5 C27.1,9.4 23.5,10.2 19.5,10.2",
)

CLEF_WIDTH = 5.3
CLEF_OFFSET = 0.588
UG_CLEF = from_musescore(
    "M37.9,-113.1 L36,-113.1 C33.9,-113.1 33.8,-113.2 33.8,-113.6 C33.8,-113.9 33.9,-114.5 34.2,-115.6 L39.1,-133.8 L37.3,-133.8 L37.3,-133.7 C35.9,-132.7 31.8,-131.5 28.7,-131.5 L28.5,-131.5 L27.9,-129.4 L31.2,-129.4 C32.3,-129.4 32.3,-129.1 32.3,-128.8 C32.3,-128.6 32.3,-128.3 32.1,-127.7 L28.9,-115.7 C28.6,-114.7 28.5,-114.2 28.5,-114.1 C28.3,-113.7 28.3,-113.5 28.1,-113.4 C27.9,-113.2 27.1,-113.1 25.9,-113.1 L24,-113.1 L23.7,-110.8 L37.6,-110.8 L37.9,-113.1 M64,-0.2 C64,-15.2 53.3,-25.5 38.7,-25.5 C37.7,-31.5 36.7,-37.4 35.9,-42.9 C46.4,-54 53.8,-66.6 53.8,-82.5 C53.8,-91.6 51,-98.9 49.3,-102.5 C47.6,-106.2 45.6,-109.1 43.9,-110.4 C44.4,-110.4 44.9,-110.3 45.4,-110.3 C50.8,-110.3 55.4,-114 55.4,-119.6 C55.4,-123.5 52.4,-125.6 48.7,-125.6 C47.4,-125.6 46.3,-125.4 44.9,-124.9 L45.8,-128.3 C48.2,-127.8 48.2,-127.8 49.6,-127.8 C52.3,-127.8 54,-128.3 55.4,-129.5 C56.5,-130.5 57.3,-132.1 57.3,-133.2 C57.3,-133.5 57.1,-133.7 56.9,-133.7 C56.8,-133.7 56.7,-133.7 56.5,-133.6 C55.1,-133 53.8,-132.8 52.1,-132.8 C50.1,-132.8 47.8,-133.1 45.2,-133.7 L45,-133.8 L42,-123.5 C41.1,-123.1 40.7,-122.5 40.7,-121.8 C40.7,-121 41.3,-120.4 42,-120.4 C43.1,-120.4 43.8,-121.1 44,-122.3 C45.4,-122.9 45.9,-123 46.6,-123 C48.5,-123 49.6,-121.6 49.6,-119.2 C49.6,-115.4 47.4,-112.5 44.7,-112.5 C43.4,-112.5 42.4,-113 42.4,-113.4 C42.4,-113.5 42.4,-113.6 42.6,-113.7 C43.9,-114.1 44.6,-115.1 44.6,-116.4 C44.6,-118 43.5,-119.1 41.8,-119.1 C39.9,-119.1 38.6,-117.7 38.6,-115.6 C38.6,-113.5 39.7,-111.9 41.7,-111.1 C40.4,-110.6 37.8,-109.2 35.1,-106 C28.7,-98.4 26.9,-85.7 26.9,-77.3 C26.9,-71.9 27.4,-67 29.1,-55.8 C29,-55.7 23.8,-50.4 21.7,-48.7 C12.6,-40.2 0,-28.1 0,-8.1 C0,10.7 16.3,25.4 34.9,25.4 C37.8,25.4 40.5,25.1 42.9,24.6 C44.7,34.2 45.9,41.3 45.9,46.6 C45.9,57 40.5,62.5 30.4,62.5 C28,62.5 25.9,62 25.7,61.9 C25.6,61.9 25.4,61.7 25.4,61.6 C25.4,61.4 25.6,61.4 25.9,61.3 C30.6,60.5 35.3,56.5 35.3,50.1 C35.3,44.8 31.2,39 23.7,39 C16.7,39 12.3,44.8 12.3,51.4 C12.3,58 17.3,66.7 30.8,66.7 C35.5,66.7 39.6,65.5 43.2,63.3 C48.6,59.5 50,52.9 50,46.6 C50,42.7 49.4,38.1 48.4,32.5 C48.1,30.5 47.6,27.4 46.9,23.6 C56.7,20.3 64,10.2 64,-0.2 M33.2,-82.1 C34.2,-86.2 38.7,-96.7 43.9,-96.7 C45.4,-96.7 47.9,-91.8 47.9,-84.9 C47.9,-74.5 40.1,-66.7 33.2,-59.8 C32.6,-63.9 32.1,-67.8 32.1,-71.9 C32.1,-75.7 32.5,-79.1 33.2,-82.1 M36.2,21.2 C21.9,21.2 9.7,11.3 9.7,-3.9 C9.7,-16 18.3,-26.9 27.1,-34.6 C28.8,-36 30.4,-37.5 31.9,-38.9 C32.8,-33.5 33.5,-28.9 34.2,-24.8 C25.1,-22.1 18.9,-12.4 18.9,-3.1 C18.9,4 24.4,13.6 32.4,13.6 C33.2,13.6 34.1,13.2 34.1,12.2 C34.1,11.4 33.2,10.8 31.9,10 C28,7.6 25.8,5 25.8,0.2 C25.8,-6 30.4,-10.8 36.2,-12.3 L42,20.6 C40,21 38.1,21.2 36.2,21.2 M46.2,19.4 C44.1,7.5 41.4,-8.4 40.7,-12.9 C50.8,-12.9 55.1,-5.8 56,-1.1 C56.1,-0.2 56.2,0.9 56.2,2.1 C56.2,9.3 53.3,16.5 46.2,19.4"
)
G_CLEF = from_musescore(
    "M12.3,51.3 C12.3,57.9 17.3,66.6 30.8,66.6 C35.5,66.6 39.6,65.4 43.2,63.2 C48.6,59.4 50,52.8 50,46.5 C50,42.6 49.4,38.1 48.4,32.4 C48.1,30.4 47.5,27.4 46.9,23.5 C56.7,20.3 64,10.1 64,-0.2 C64,-15.3 53.3,-25.5 38.7,-25.5 C37.7,-31.5 36.7,-37.4 35.9,-43 C46.4,-54.1 53.7,-66.6 53.7,-82.5 C53.7,-91.6 50.9,-99 49.3,-102.6 C46.9,-107.7 44,-111.2 42.2,-111.2 C41.5,-111.2 38.4,-110 35.1,-106.1 C28.7,-98.5 26.9,-85.7 26.9,-77.3 C26.9,-71.9 27.4,-67 29.1,-55.8 C29,-55.7 23.8,-50.4 21.7,-48.7 C12.6,-40.3 0,-28.1 0,-8.1 C0,10.6 16.3,25.3 34.9,25.3 C37.8,25.3 40.5,25 42.8,24.6 C44.7,34.2 45.9,41.2 45.9,46.5 C45.9,56.9 40.5,62.4 30.4,62.4 C28,62.4 25.9,61.9 25.7,61.9 C25.6,61.8 25.4,61.7 25.4,61.6 C25.4,61.4 25.6,61.3 25.9,61.3 C30.6,60.5 35.3,56.5 35.3,50.1 C35.3,44.7 31.2,39 23.7,39 C16.7,39 12.3,44.7 12.3,51.3 M33.2,-82.2 C34.1,-86.2 38.7,-96.7 43.9,-96.7 C45.4,-96.7 47.8,-91.9 47.8,-84.9 C47.8,-74.5 40.1,-66.7 33.2,-59.9 C32.6,-63.9 32.1,-67.8 32.1,-72 C32.1,-75.7 32.4,-79.1 33.2,-82.2 M42,20.6 C40,21 38.1,21.2 36.2,21.2 C21.9,21.2 9.7,11.2 9.7,-3.9 C9.7,-16.1 18.3,-27 27.1,-34.6 C28.8,-36.1 30.4,-37.5 31.9,-39 C32.8,-33.6 33.5,-28.9 34.2,-24.8 C25.1,-22.1 18.9,-12.5 18.9,-3.1 C18.9,3.9 24.4,13.5 32.4,13.5 C33.2,13.5 34.1,13.1 34.1,12.2 C34.1,11.3 33.1,10.8 31.9,10 C28,7.6 25.8,5 25.8,0.1 C25.8,-6 30.4,-10.9 36.2,-12.3 L42,20.6 M56.2,2.1 C56.2,9.2 53.3,16.5 46.2,19.4 C44.1,7.4 41.4,-8.5 40.7,-12.9 C49.7,-12.9 56.2,-6.8 56.2,2.1"
)
F_CLEF = from_musescore(
    "M25.4,-25.1 C17.8,-25.1 11.7,-20.7 11.6,-20.7 C5.7,-16.4 1.9,-9.8 1.9,-2.5 C1.9,4.8 6.1,10.2 13.5,10.2 C19.9,10.2 24.9,5.9 24.9,-0.7 C24.9,-6.4 19.9,-11.1 14.3,-11.1 C13.1,-11.1 12,-10.9 11.1,-10.6 C10.1,-10.2 8.4,-9.2 7.6,-8.5 C8.3,-12.9 11.3,-17.3 15.2,-19.4 C17.7,-20.8 20.9,-21.4 24.4,-21.4 C34.6,-21.4 39.6,-13.2 39.6,3.6 C39.6,16.6 31.3,35.3 21.5,44.1 C11.1,53.6 1.3,58.1 1.2,58.1 C1.2,58.1 0,58.8 0,60 C0,60.2 0.1,60.3 0.1,60.5 C0.4,61.5 1.3,61.7 2,61.7 L2.3,61.6 C2.5,61.6 13.9,56.9 23,49.8 C37,39.7 52.8,21.9 52.8,3.5 C52.8,-13.9 43.4,-25.1 25.4,-25.1 M56.8,-12.4 C56.8,-9.6 59,-7.4 61.6,-7.4 C64.2,-7.4 66.4,-9.6 66.4,-12.4 C66.4,-15.2 64.2,-17.5 61.6,-17.5 C59,-17.5 56.8,-15.2 56.8,-12.4 M56.8,12.3 C56.8,15.1 59,17.4 61.6,17.4 C64.2,17.4 66.4,15.1 66.4,12.3 C66.4,9.5 64.2,7.2 61.6,7.2 C59,7.2 56.8,9.5 56.8,12.3"
)
LF_CLEF = from_musescore(
    "M25.3,-25.1 C17.7,-25.1 11.7,-20.7 11.6,-20.7 C5.7,-16.4 1.9,-9.8 1.9,-2.5 C1.9,5 6.2,10.2 13.7,10.2 C20,10.2 24.9,5.8 24.9,-0.7 C24.9,-6.5 19.9,-11.1 14.2,-11.1 C12.9,-11.1 11.9,-10.9 11,-10.6 C10,-10.2 8.4,-9.2 7.6,-8.5 C8.3,-12.9 11.3,-17.3 15.2,-19.4 C17.7,-20.8 20.9,-21.4 24.4,-21.4 C34.6,-21.4 39.6,-13.2 39.6,3.6 C39.6,16.6 31.3,35.3 21.5,44.1 C11.1,53.6 1.3,58.1 1.2,58.1 L1.1,58.1 C1.1,58.1 0,58.8 0,60 C0,60.1 0.1,60.3 0.1,60.5 C0.4,61.5 1.2,61.7 1.9,61.7 L2.3,61.6 C2.5,61.6 13.9,56.8 23,49.7 C32.4,42.9 40,35.5 45.9,25.5 C50.3,18 52.8,10.2 52.8,3.5 C52.8,-14 43.3,-25.1 25.3,-25.1 M56.7,-12.4 C56.7,-9.6 58.9,-7.4 61.5,-7.4 C64.1,-7.4 66.3,-9.6 66.3,-12.4 C66.3,-15.2 64.1,-17.5 61.5,-17.5 C58.9,-17.5 56.7,-15.2 56.7,-12.4 M56.7,12.3 C56.7,15.1 58.9,17.4 61.5,17.4 C64.1,17.4 66.3,15.1 66.3,12.3 C66.3,9.5 64.1,7.2 61.5,7.2 C58.9,7.2 56.7,9.5 56.7,12.3 M25.9,71 C25.9,70.7 26,70.2 26.3,69.1 L31.2,50.9 L29.4,50.9 L29.4,51 C28,52 23.9,53.1 20.8,53.2 L20.6,53.2 L20,55.3 L23.3,55.3 C24.4,55.3 24.4,55.6 24.4,55.9 C24.4,56.2 24.3,56.7 24.2,57 L21,69 C20.7,70 20.6,70.4 20.6,70.5 L20.5,70.6 C20.4,71.1 20.3,71.1 20.2,71.2 L20.2,71.3 C20,71.6 19.2,71.6 18,71.6 L16.1,71.6 L15.8,73.9 L29.7,73.9 L30,71.6 L28.1,71.6 C26,71.6 25.9,71.4 25.9,71 M49,51 C48.9,51 48.8,51 48.7,51 L48.6,51.1 C47.2,51.7 45.9,51.9 44.2,51.9 C42.2,51.9 39.9,51.6 37.3,51 L37.1,50.9 L34.1,61.1 C33.2,61.5 32.8,62.1 32.8,62.9 C32.8,63.7 33.3,64.3 34.1,64.3 C35.1,64.3 35.9,63.6 36.1,62.4 C37.6,61.8 38,61.6 38.7,61.6 C40.6,61.6 41.7,63 41.7,65.5 C41.7,69.3 39.5,72.2 36.8,72.2 C35.5,72.2 34.5,71.6 34.5,71.1 C34.5,71.1 34.6,71 34.7,71 C36,70.6 36.7,69.6 36.7,68.3 C36.7,66.7 35.6,65.6 33.9,65.6 C32,65.6 30.7,67 30.7,69.1 C30.7,72.3 33.4,74.4 37.5,74.4 C42.9,74.4 47.4,70.6 47.4,65.1 C47.4,61.1 44.6,59.1 40.8,59.1 C39.5,59.1 38.4,59.3 37,59.8 L37.9,56.4 C40.2,56.9 40.3,56.9 41.7,56.9 C44.3,56.9 46.1,56.3 47.5,55.1 C48.5,54.2 49.4,52.6 49.4,51.5 C49.4,51.1 49.2,51 49,51"
)


DSHARP = from_musescore(
    "M8.6,7 L13.6,2.2 L13.9,2.2 L18.8,7 L18.8,12.3 C18.8,13.1 19.4,13.7 20.2,13.7 L26.1,13.7 C26.9,13.7 27.5,13.1 27.5,12.3 L27.5,6.4 C27.5,5.6 26.9,5.1 26.1,5.1 L20.8,5.1 L15.8,0.1 L15.8,-0.1 L20.8,-5.1 L26.1,-5.1 C26.9,-5.1 27.5,-5.7 27.5,-6.5 L27.5,-12.4 C27.5,-13.2 26.9,-13.8 26.1,-13.8 L20.2,-13.8 C19.4,-13.8 18.8,-13.2 18.8,-12.4 L18.8,-7.1 L13.9,-2.1 L13.6,-2.1 L8.6,-7.1 L8.6,-12.4 C8.6,-13.2 8.1,-13.8 7.3,-13.8 L1.4,-13.8 C0.6,-13.8 0,-13.2 0,-12.4 L0,-6.5 C0,-5.7 0.6,-5.1 1.4,-5.1 L6.7,-5.1 L11.6,-0.2 L11.6,0.1 L6.7,5.1 L1.4,5.1 C0.6,5.1 0,5.6 0,6.4 L0,12.3 C0,13.1 0.6,13.7 1.4,13.7 L7.3,13.7 C8.1,13.7 8.6,13.1 8.6,12.3 L8.6,7"
)
SHARP = from_musescore(
    "M23.3,-10.5 C23.9,-10.6 24.4,-11.3 24.4,-11.9 L24.4,-17.8 C24.4,-18.8 23.7,-19.2 22.8,-19.2 L19.5,-18.5 L19.5,-33.4 L16.7,-33.4 L16.7,-17.9 L7.8,-16.1 L7.8,-30.2 L5,-30.2 L5,-15.5 L1.1,-14.7 C0.5,-14.6 0,-13.9 0,-13.3 L0,-7.5 C0,-6.4 0.8,-6.1 1.7,-6.1 L5,-6.8 L5,9.7 L1.1,10.5 C0.5,10.6 0,11.3 0,11.9 L0,17.7 C0,18.8 0.8,19.1 1.7,19.1 L5,18.4 L5,33.3 L7.8,33.3 L7.8,17.8 L16.7,16 L16.7,30.1 L19.5,30.1 L19.5,15.4 L23.3,14.7 C23.9,14.6 24.4,13.9 24.4,13.3 L24.4,7.4 C24.4,6.4 23.7,6 22.8,6 L19.5,6.7 L19.5,-9.8 L23.3,-10.5 M7.8,-7.4 L16.7,-9.2 L16.7,7.3 L7.8,9.2 L7.8,-7.4"
)
NATURAL = from_musescore(
    "M16.6,-18.3 C16.4,-18.5 16.1,-18.6 15.7,-18.6 L15.5,-18.5 C15.5,-18.5 15.4,-18.5 15.4,-18.5 L2.8,-15 L2.8,-32.5 L0,-32.5 L0,17 C0,18.1 0.9,18.3 1.8,18.3 L14.4,14.8 L14.4,32.3 L17.1,32.3 C17.1,15.7 17.1,-0.1 17.1,-17.2 C17.1,-17.6 16.9,-18.1 16.6,-18.3 M2.8,9.7 L2.8,-6.7 L14.4,-10 L14.4,6.5 L2.8,9.7"
)
FLAT = from_musescore(
    "M12,-15.5 C7,-15.5 4.1,-12.4 3.6,-11.8 L4,-43.9 C4,-44.7 3.4,-45.3 2.6,-45.3 L1.4,-45.3 C0.6,-45.3 0,-44.7 0,-43.9 L0.5,16.2 C0.5,17 1.1,17.6 1.9,17.6 C2.1,17.6 2.5,17.5 2.7,17.4 C11.3,13.1 20.3,4.9 20.3,-5.4 C20.3,-10.6 17.9,-15.5 12,-15.5 M3.3,12.7 L3.6,-6.8 C3.8,-7.7 5.3,-10.6 9.3,-10.6 C12.9,-10.6 13.2,-7.2 13.2,-5.1 C13.2,3.8 9.9,7.5 3.3,12.7"
)
DFLAT = from_musescore(
    "M28.8,-15.5 C23.8,-15.5 20.9,-12.5 20.4,-11.9 L20.8,-43.9 C20.8,-44.7 20.2,-45.3 19.4,-45.3 L18.2,-45.3 C17.4,-45.3 16.8,-44.7 16.8,-43.9 L17.1,-13.8 C15.8,-14.8 14.2,-15.5 12,-15.5 C7,-15.5 4.1,-12.4 3.6,-11.8 L4,-43.9 C4,-44.7 3.4,-45.3 2.6,-45.3 L1.4,-45.3 C0.6,-45.3 0,-44.7 0,-43.9 L0.5,16.2 C0.5,17 1.1,17.6 1.9,17.6 C2.1,17.6 2.5,17.4 2.7,17.3 C8.5,14.4 13.6,10.2 17.2,4.8 L17.3,16.2 C17.3,17 17.9,17.6 18.7,17.6 C18.9,17.6 19.3,17.4 19.5,17.3 C28.1,13 37.1,4.8 37.1,-5.5 C37.1,-10.7 34.7,-15.5 28.8,-15.5 M3.3,12.7 L3.6,-6.8 C3.8,-7.7 5.3,-10.6 9.3,-10.6 C12.9,-10.6 13.2,-7.2 13.2,-5.1 C13.2,3.8 9.9,7.5 3.3,12.7 M20.1,12.7 L20.4,-6.8 C20.6,-7.7 22.1,-10.6 26.1,-10.6 C29.7,-10.6 30,-7.2 30,-5.1 C30,3.8 26.7,7.5 20.1,12.7"
)

SVG_ACC_MAP = {
    "+": DSHARP,
    "#": SHARP,
    "": draw.Group(),
    "n": NATURAL,
    "b": FLAT,
    "&": DFLAT,
}

SVG_ACC_WIDTH = {
    "+": 2.2,
    "#": 1.95,
    "": 0.0,
    "n": 1.37,
    "b": 1.62,
    "&": 2.97,
}

SVG_ACC_OFFSET = {
    key: val + ACC_MARGIN if key != "" else 0 for key, val in SVG_ACC_WIDTH.items()
}
